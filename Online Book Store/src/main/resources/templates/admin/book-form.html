<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::content})}">
<body>

<div th:fragment="content">
<div class="auth-card" style="max-width:780px">
    <h1 th:text="${bookId} != null ? 'Edit Book' : 'Add Book'">Book</h1>

    <form th:action="${bookId} != null ? @{'/admin/books/' + ${bookId}} : @{/admin/books}"
          method="post" enctype="multipart/form-data" th:object="${book}">

        <div class="grid2">
            <div>
                <label>Title</label>
                <input type="text" th:field="*{title}" required/>
            </div>
            <div>
                <label>Author</label>
                <input type="text" th:field="*{author}" required/>
            </div>
        </div>

        <label>Description</label>
        <textarea th:field="*{description}" rows="4" required></textarea>

        <div class="grid2">
            <div>
                <label>Category</label>
                <select th:field="*{category}">
                    <option th:each="c : ${categories}" th:value="${c}" th:text="${c}"></option>
                </select>
            </div>
            <div>
                <label>Status</label>
                <select th:field="*{availabilityStatus}">
                    <option th:each="s : ${statuses}" th:value="${s}" th:text="${s}"></option>
                </select>
            </div>
        </div>

        <div class="grid3">
            <div>
                <label>Price</label>
                <input type="number" step="0.01" th:field="*{price}" required/>
            </div>
            <div>
                <label>Discount % (0-20)</label>
                <input type="number" step="0.01" th:field="*{discountPercent}"/>
            </div>
            <div>
                <label>Stock Qty</label>
                <input type="number" th:field="*{stockQuantity}" required min="0"/>
            </div>
        </div>

        <label>Image URL</label>
        <input type="text" th:field="*{imageUrl}" placeholder="https://... (optional if uploading below)"/>

        <label>Upload Image</label>
        <input type="file" name="imageFile" accept="image/*" onchange="previewImage(event)"/>
        <div style="margin-top:10px" th:if="*{imageUrl != null and !imageUrl.isEmpty()}">
            <img th:src="*{imageUrl}" id="book-image-preview" alt="Book cover preview" class="thumb" style="width:84px;height:84px;"/>
        </div>
        <div style="margin-top:10px" th:if="*{imageUrl == null or imageUrl.isEmpty()}">
            <img id="book-image-preview" alt="Book cover preview" class="thumb" style="width:84px;height:84px;display:none;"/>
        </div>

        <div class="row gap" style="margin-top:14px">
            <button type="submit">Save</button>
            <a class="btn" th:href="@{/admin/books}">Cancel</a>
        </div>
    </form>
</div>
    <script>
        function previewImage(event) {
            const file = event.target.files && event.target.files[0];
            if (!file) return;
            const image = document.getElementById('book-image-preview');
            image.src = URL.createObjectURL(file);
            image.style.display = 'block';
        }
    </script>


</body>
</html>
